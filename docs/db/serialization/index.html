
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for Aqueduct, a Dart server-side framework.">
      
      
      
      
        <link rel="shortcut icon" href="../../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.9.0">
    
    
      
        <title>Storage, Serialization and Deserialization - Aqueduct 3.0 Pre-release</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-e826f8942a.js"></script>
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-0a3554af36.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../style/css/override.css">
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="../.." title="Aqueduct 3.0 Pre-release" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Guides
                </span>
              
                <span class="md-header-nav__parent">
                  Databases and ORM
                </span>
              
            
            Storage, Serialization and Deserialization
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="" data-md-lang-tokenizer="[\s\-]+">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/stablekernel/aqueduct" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    Aqueduct 3.0 Pre-release
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/stablekernel/aqueduct" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../core_concepts/" title="Core Concepts" class="md-nav__link">
      Core Concepts
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../getting_started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../tour/" title="Tour" class="md-nav__link">
      Tour
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../migration/" title="3.0 Migration Guide" class="md-nav__link">
      3.0 Migration Guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../best_practices/" title="Best Practices" class="md-nav__link">
      Best Practices
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../intellij/" title="IntelliJ IDEA Templates" class="md-nav__link">
      IntelliJ IDEA Templates
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Snippets
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Snippets
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../snippets/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../snippets/http/" title="HTTP" class="md-nav__link">
      HTTP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../snippets/orm/" title="ORM" class="md-nav__link">
      ORM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../snippets/auth/" title="Authentication and Authorization" class="md-nav__link">
      Authentication and Authorization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../snippets/test/" title="Testing" class="md-nav__link">
      Testing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Tutorial
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tut/getting-started/" title="1. Getting Started" class="md-nav__link">
      1. Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tut/executing-queries/" title="2. Reading from a Database" class="md-nav__link">
      2. Reading from a Database
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tut/storing-data/" title="3. Storing Data in a Database" class="md-nav__link">
      3. Storing Data in a Database
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10" checked>
    
    <label class="md-nav__link" for="nav-10">
      Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10-1" type="checkbox" id="nav-10-1">
    
    <label class="md-nav__link" for="nav-10-1">
      Serving HTTP Requests
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-10-1">
        Serving HTTP Requests
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/structure/" title="Application Structure" class="md-nav__link">
      Application Structure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/request_and_response/" title="Request and Response Objects" class="md-nav__link">
      Request and Response Objects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/controller/" title="Handling Requests: Fundamentals" class="md-nav__link">
      Handling Requests: Fundamentals
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/routing/" title="Routing" class="md-nav__link">
      Routing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/channel/" title="Initialization and the ApplicationChannel" class="md-nav__link">
      Initialization and the ApplicationChannel
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/resource_controller/" title="Handling Requests: ResourceController" class="md-nav__link">
      Handling Requests: ResourceController
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/configure/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/serving_files/" title="Serving Files and Caching" class="md-nav__link">
      Serving Files and Caching
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/websockets/" title="Websockets" class="md-nav__link">
      Websockets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/threading/" title="Multi-threading" class="md-nav__link">
      Multi-threading
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10-2" type="checkbox" id="nav-10-2" checked>
    
    <label class="md-nav__link" for="nav-10-2">
      Databases and ORM
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-10-2">
        Databases and ORM
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../connecting/" title="Connecting to a Database" class="md-nav__link">
      Connecting to a Database
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../modeling_data/" title="Modeling Data" class="md-nav__link">
      Modeling Data
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Storage, Serialization and Deserialization
      </label>
    
    <a href="./" title="Storage, Serialization and Deserialization" class="md-nav__link md-nav__link--active">
      Storage, Serialization and Deserialization
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#null-behavior" title="Null Behavior" class="md-nav__link">
    Null Behavior
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#transient-properties-and-serializationdeserialization" title="Transient Properties and Serialization/Deserialization" class="md-nav__link">
    Transient Properties and Serialization/Deserialization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serialization-and-deserialization-of-relationship-properties" title="Serialization and Deserialization of Relationship Properties" class="md-nav__link">
    Serialization and Deserialization of Relationship Properties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../executing_queries/" title="Executing Queries" class="md-nav__link">
      Executing Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced_queries/" title="Advanced Queries" class="md-nav__link">
      Advanced Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../transactions/" title="Transactions" class="md-nav__link">
      Transactions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../validations/" title="Validations" class="md-nav__link">
      Validations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../db_tools/" title="Migration and Tooling" class="md-nav__link">
      Migration and Tooling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../json_columns/" title="JSON Document Storage" class="md-nav__link">
      JSON Document Storage
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../transactions/" title="Transactions" class="md-nav__link">
      Transactions
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10-3" type="checkbox" id="nav-10-3">
    
    <label class="md-nav__link" for="nav-10-3">
      Authorization and OAuth 2.0
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-10-3">
        Authorization and OAuth 2.0
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../auth/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../auth/server/" title="Setting up Authorization" class="md-nav__link">
      Setting up Authorization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../auth/authorizer/" title="Protecting Routes" class="md-nav__link">
      Protecting Routes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../auth/controllers/" title="Issuing Access Tokens" class="md-nav__link">
      Issuing Access Tokens
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../auth/cli/" title="Managing OAuth 2.0 Clients" class="md-nav__link">
      Managing OAuth 2.0 Clients
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../auth/auth_scopes/" title="OAuth 2.0 Scoping" class="md-nav__link">
      OAuth 2.0 Scoping
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../auth/what_is_oauth/" title="What is OAuth 2.0?" class="md-nav__link">
      What is OAuth 2.0?
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10-4" type="checkbox" id="nav-10-4">
    
    <label class="md-nav__link" for="nav-10-4">
      Development and Testing
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-10-4">
        Development and Testing
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../testing/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../testing/tests/" title="Writing Tests" class="md-nav__link">
      Writing Tests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../testing/mixins/" title="Testing with the ORM and OAuth 2.0" class="md-nav__link">
      Testing with the ORM and OAuth 2.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../testing/debugger/" title="Using the Debugger" class="md-nav__link">
      Using the Debugger
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../testing/clients/" title="Developing Client Applications" class="md-nav__link">
      Developing Client Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../testing/mock/" title="Mocking Services" class="md-nav__link">
      Mocking Services
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10-5" type="checkbox" id="nav-10-5">
    
    <label class="md-nav__link" for="nav-10-5">
      Deployment
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-10-5">
        Deployment
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/deploy_local/" title="Deploy Locally" class="md-nav__link">
      Deploy Locally
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/deploy_heroku/" title="Deploy on Heroku" class="md-nav__link">
      Deploy on Heroku
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/deploy_aws/" title="Deploy on AWS" class="md-nav__link">
      Deploy on AWS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/script/" title="Deploying without aqueduct serve" class="md-nav__link">
      Deploying without aqueduct serve
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10-6" type="checkbox" id="nav-10-6">
    
    <label class="md-nav__link" for="nav-10-6">
      OpenAPI Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-10-6">
        OpenAPI Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../openapi/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../openapi/cli/" title="Creating an OpenAPI Document" class="md-nav__link">
      Creating an OpenAPI Document
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../openapi/components/" title="Documenting Components" class="md-nav__link">
      Documenting Components
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../openapi/endpoint/" title="Documenting Endpoint Controllers" class="md-nav__link">
      Documenting Endpoint Controllers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../openapi/middleware/" title="Documenting Middleware Controllers" class="md-nav__link">
      Documenting Middleware Controllers
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10-7" type="checkbox" id="nav-10-7">
    
    <label class="md-nav__link" for="nav-10-7">
      Command-line Tooling
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-10-7">
        Command-line Tooling
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/create/" title="Creating Applications" class="md-nav__link">
      Creating Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/running/" title="Running Applications" class="md-nav__link">
      Running Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/document/" title="Generating an OpenAPI/Swagger Specification" class="md-nav__link">
      Generating an OpenAPI/Swagger Specification
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/setup/" title="Other Tools" class="md-nav__link">
      Other Tools
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#null-behavior" title="Null Behavior" class="md-nav__link">
    Null Behavior
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#transient-properties-and-serializationdeserialization" title="Transient Properties and Serialization/Deserialization" class="md-nav__link">
    Transient Properties and Serialization/Deserialization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serialization-and-deserialization-of-relationship-properties" title="Serialization and Deserialization of Relationship Properties" class="md-nav__link">
    Serialization and Deserialization of Relationship Properties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/stablekernel/aqueduct/edit/master/docs/db/serialization.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="storage-serialization-and-deserialization">Storage, Serialization and Deserialization</h1>
<p>In the previous chapter, you have seen that <code>ManagedObject&lt;T&gt;</code>s subclasses are responsible for representing database rows and can be encoded to or decoded from formats like JSON or XML. This chapter explains the behavior of those transformations.</p>
<p><code>ManagedObject&lt;T&gt;</code> implements <code>Serializable</code> so that they can read from a <code>Map</code> or converted to a <code>Map</code>. A <code>ManagedObject&lt;T&gt;</code> can be passed as the body object of a <code>Response</code> and bound to <code>Bind.body</code> variables in <code>ResourceController</code>:</p>
<div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">UserController</span> <span class="kd">extends</span> <span class="n">ResourceController</span> <span class="p">{</span>
  <span class="err">@</span><span class="n">Operation</span><span class="p">.</span><span class="n">post</span><span class="p">()</span>
  <span class="n">Future</span><span class="o">&lt;</span><span class="n">Response</span><span class="o">&gt;</span> <span class="n">createUser</span><span class="p">(</span><span class="err">@</span><span class="n">Bind</span><span class="p">.</span><span class="n">body</span><span class="p">()</span> <span class="n">User</span> <span class="n">user</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
      <span class="p">..</span><span class="n">values</span> <span class="o">=</span> <span class="n">user</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">Response</span><span class="p">.</span><span class="n">ok</span><span class="p">(</span><span class="kd">await</span> <span class="n">query</span><span class="p">.</span><span class="n">insert</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Note that <code>ManagedObject&lt;T&gt;</code>s don't have anything to do with JSON, XML or some other format here. Other parts of Aqueduct manage moving data back and forth between JSON and <code>Map</code>s - <code>ManagedObject&lt;T&gt;</code> doesn't care about the transmission format as long as its a <code>Map</code> or <code>List&lt;Map&gt;</code>.</p>
<h2 id="null-behavior">Null Behavior</h2>
<p>It's important to understand how <code>null</code> works when reading from or writing to a <code>Map</code> with a <code>ManagedObject&lt;T&gt;</code>. Consider the following managed object:</p>
<div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">User</span> <span class="kd">extends</span> <span class="n">ManagedObject</span><span class="o">&lt;</span><span class="n">_User</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">_User</span> <span class="p">{}</span>
<span class="kd">class</span> <span class="nc">_User</span> <span class="p">{</span>
  <span class="err">@</span><span class="n">primaryKey</span>
  <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>

  <span class="kt">String</span> <span class="n">name</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p><code>User</code> has two properties, <code>id</code> and <code>name</code>. If we read a <code>User</code> from a <code>Map</code> that does not contain an <code>id</code> key, its <code>id</code> will be null. If we convert <code>User</code> to a <code>Map</code>, the key <code>id</code> will not be present:</p>
<div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="n">userMap</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="s2">&quot;Bob&quot;</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">()..</span><span class="n">readFromMap</span><span class="p">(</span><span class="n">userMap</span><span class="p">);</span>

<span class="n">user</span><span class="p">.</span><span class="n">id</span> <span class="o">==</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// yup</span>
<span class="n">user</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Bob&quot;</span><span class="p">;</span> <span class="c1">// yup</span>

<span class="kd">var</span> <span class="n">outUserMap</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">asMap</span><span class="p">();</span>
<span class="n">outUserMap</span> <span class="o">==</span> <span class="p">{</span>
  <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="s2">&quot;Bob&quot;</span>
<span class="p">};</span>
</pre></div>


<p>However, if we read <code>User</code> from a <code>Map</code> where the <code>id</code> key is the <em>value</em> null, when we transform it back to a <code>Map</code> the <code>id</code> is present and its value is null:</p>
<div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="n">userMap</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;id&quot;</span> <span class="o">:</span> <span class="kc">null</span>
  <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="s2">&quot;Bob&quot;</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">()..</span><span class="n">readFromMap</span><span class="p">(</span><span class="n">userMap</span><span class="p">);</span>

<span class="n">user</span><span class="p">.</span><span class="n">id</span> <span class="o">==</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// yup</span>
<span class="n">user</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Bob&quot;</span><span class="p">;</span> <span class="c1">// yup</span>

<span class="kd">var</span> <span class="n">outUserMap</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">asMap</span><span class="p">();</span>
<span class="n">outUserMap</span> <span class="o">==</span> <span class="p">{</span>
  <span class="s2">&quot;id&quot;</span> <span class="o">:</span> <span class="kc">null</span>
  <span class="s2">&quot;name&quot;</span> <span class="o">:</span> <span class="s2">&quot;Bob&quot;</span>
<span class="p">};</span>
</pre></div>


<p>A <code>ManagedObject&lt;T&gt;</code> like <code>User</code> makes the distinction between a value that is <code>null</code> and a value that it <em>doesn't have enough information for</em>. A property of a <code>ManagedObject&lt;T&gt;</code> can get set in three ways: it is read from a map, its setter is invoked or it is read from the database. In all three of these situations, not every property is available. This is no more obvious than when  creating a brand new instance:</p>
<div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">();</span>
<span class="n">user</span><span class="p">.</span><span class="n">id</span> <span class="o">==</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// yup</span>
<span class="n">user</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// yup</span>

<span class="n">user</span><span class="p">.</span><span class="n">asMap</span><span class="p">()</span> <span class="o">==</span> <span class="p">{};</span> <span class="c1">// yup</span>
</pre></div>


<p>A <code>ManagedObject&lt;T&gt;</code> will not include keys in its <code>asMap()</code> if it doesn't have a value for them. The value may exist somewhere else - like in the database - but if it doesn't have it, it won't include it. This distinction is useful information for clients of Aqueduct applications.</p>
<p>So what about values that are actually <code>null</code>? A property with the value <code>null</code> will be included in <code>asMap()</code> if its been read from the database, read using <code>readFromMap()</code> or explicitly assigned with a setter. The following three user objects will all have <code>{"name": null}</code>:</p>
<div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="n">user1</span> <span class="o">=</span> <span class="n">User</span><span class="p">()</span>
  <span class="p">..</span><span class="n">id</span> <span class="o">=</span> <span class="m">1</span>
  <span class="p">..</span><span class="n">name</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="kd">var</span> <span class="n">user2</span> <span class="o">=</span> <span class="n">User</span><span class="p">()..</span><span class="n">readFromMap</span><span class="p">({</span>
  <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="m">2</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="kc">null</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
  <span class="p">..</span><span class="n">where</span><span class="p">((</span><span class="n">u</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="p">).</span><span class="n">equalTo</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
  <span class="p">..</span><span class="n">where</span><span class="p">((</span><span class="n">u</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">u</span><span class="p">.</span><span class="n">name</span><span class="p">).</span><span class="n">isNull</span><span class="p">();</span>
<span class="kd">var</span> <span class="n">user3</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">query</span><span class="p">.</span><span class="n">fetchOne</span><span class="p">();</span>
</pre></div>


<p>Note that an unset value that is returned from a getter will be <code>null</code>. If using an object's values to perform some calculation, it's your job to know if the value has been fetched or not. (While <code>ManagedObject&lt;T&gt;.hasValueForProperty()</code> checks this at runtime, that isn't a good practice.)</p>
<p>One last thing to note: if you wish to remove a value from a <code>ManagedObject&lt;T&gt;</code>s storage (and likewise, its <code>asMap()</code>), you must use <code>ManagedObject&lt;T&gt;.removePropertyFromBackingMap()</code>.</p>
<p>It is helpful to think of a <code>ManagedObject&lt;T&gt;</code> as a proxy to a database row that may or may not exist yet, and may have less data than actually exists in the database row.</p>
<h3 id="transient-properties-and-serializationdeserialization">Transient Properties and Serialization/Deserialization</h3>
<p>By default, transient properties and getters - those declared in the subclass of <code>ManagedObject&lt;T&gt;</code> - are <em>not</em> included in the <code>asMap()</code>. (Setters are obviously not included, as you can't get a value from them.) To include a transient property or getter in <code>asMap()</code>, you may mark it with <code>@Serialize()</code> metadata. Properties marked with this metadata will be included in <code>asMap()</code> if and only if they are not null. A good reason to use this feature is when you want to provide a value to the consumer of the API that is derived from persistent properties:</p>
<div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">User</span> <span class="kd">extends</span> <span class="n">ManagedObject</span><span class="o">&lt;</span><span class="n">_User</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">_User</span> <span class="p">{</span>
  <span class="err">@</span><span class="n">Serialize</span><span class="p">()</span>
  <span class="kt">String</span> <span class="kd">get</span> <span class="n">fullName</span> <span class="o">=&gt;</span> <span class="s2">&quot;</span><span class="si">$</span><span class="n">firstName</span><span class="s2"> </span><span class="si">$</span><span class="n">lastName</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">_User</span> <span class="p">{</span>
  <span class="kt">String</span> <span class="n">firstName</span><span class="p">;</span>
  <span class="kt">String</span> <span class="n">lastName</span><span class="p">;</span>

  <span class="p">...</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">()</span>
  <span class="p">..</span><span class="n">firstName</span> <span class="o">=</span> <span class="s2">&quot;Bob&quot;</span>
  <span class="p">..</span><span class="n">lastName</span> <span class="o">=</span> <span class="s2">&quot;Boberson&quot;</span><span class="p">;</span>

<span class="kd">var</span> <span class="n">map</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">asMap</span><span class="p">();</span>
<span class="n">map</span> <span class="o">==</span> <span class="p">{</span>
  <span class="s1">&#39;firstName&#39;</span> <span class="o">:</span> <span class="s1">&#39;Bob&#39;</span><span class="p">,</span>
  <span class="s1">&#39;lastName&#39;</span> <span class="o">:</span> <span class="s1">&#39;Boberson&#39;</span><span class="p">,</span>
  <span class="s1">&#39;fullName&#39;</span> <span class="o">:</span> <span class="s1">&#39;Bob Boberson&#39;</span>
<span class="p">};</span>
</pre></div>


<p>Transient properties with this annotation may also be used as inputs when reading with <code>readFromMap()</code>. For example, consider how to handle user passwords. A password is not stored in plain-text in a database, but they are sent in requests. Thus, a password could read from a request body, but it needs to be salted, hashed and stored in two columns in the database. An instance type could then define a password property, which automatically set the salt and hash of the password in the table definition:</p>
<div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">User</span> <span class="kd">extends</span> <span class="n">ManagedObject</span><span class="o">&lt;</span><span class="n">_User</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">_User</span> <span class="p">{</span>
  <span class="err">@</span><span class="n">Serialize</span><span class="p">()</span>
  <span class="kt">void</span> <span class="kd">set</span> <span class="n">password</span><span class="p">(</span><span class="kt">String</span> <span class="n">pw</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">salt</span> <span class="o">=</span> <span class="n">generateSalt</span><span class="p">();</span>
    <span class="n">hashedPassword</span> <span class="o">=</span> <span class="n">hash</span><span class="p">(</span><span class="n">pw</span><span class="p">,</span> <span class="n">salt</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kd">class</span> <span class="nc">_User</span> <span class="p">{</span>
  <span class="kt">String</span> <span class="n">salt</span><span class="p">;</span>
  <span class="kt">String</span> <span class="n">hashedPassword</span><span class="p">;</span>
  <span class="p">...</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="n">map</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;password&#39;</span> <span class="o">:</span> <span class="s1">&#39;mypassword&#39;</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">()..</span><span class="n">readFromMap</span><span class="p">(</span><span class="n">map</span><span class="p">);</span>
<span class="kd">var</span> <span class="n">salt</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">salt</span><span class="p">;</span> <span class="c1">// &#39;somerandomstring&#39;</span>
<span class="kd">var</span> <span class="n">hashedPassword</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">hashedPassword</span><span class="p">;</span> <span class="c1">// &#39;somehashedstring&#39;</span>

<span class="kd">var</span> <span class="n">password</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">password</span><span class="p">;</span> <span class="c1">// Analyzer error - user.password doesn&#39;t exist!</span>
</pre></div>


<p>A transient property can also be used only when reading or only when writing.</p>
<div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">User</span> <span class="kd">extends</span> <span class="n">ManagedObject</span><span class="o">&lt;</span><span class="n">_User</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">_User</span> <span class="p">{</span>
  <span class="err">@</span><span class="n">Serialize</span><span class="p">(</span><span class="nl">input:</span> <span class="kc">true</span><span class="p">,</span> <span class="nl">output:</span> <span class="kc">false</span><span class="p">)</span>
  <span class="kt">String</span> <span class="n">readable</span><span class="p">;</span> <span class="c1">// Can be readFromMap, but not emitted in asMap</span>

  <span class="err">@</span><span class="n">Serialize</span><span class="p">(</span><span class="nl">input:</span> <span class="kc">false</span><span class="p">,</span> <span class="nl">output:</span> <span class="kc">true</span><span class="p">)</span>
  <span class="kt">String</span> <span class="n">writable</span><span class="p">;</span> <span class="c1">// Is emitted in asMap, but cannot be readFromMap.</span>
<span class="p">}</span>
</pre></div>


<p>Also, a separate getter and setter may exist for the same name to allow both input and output:</p>
<div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">User</span> <span class="kd">extends</span> <span class="n">ManagedObject</span><span class="o">&lt;</span><span class="n">_User</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">_User</span> <span class="p">{</span>
  <span class="err">@</span><span class="n">Serialize</span><span class="p">()</span>
  <span class="kt">void</span> <span class="kd">set</span> <span class="n">transientValue</span><span class="p">(</span><span class="kt">String</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
  <span class="p">}</span>

  <span class="err">@</span><span class="n">Serialize</span><span class="p">()</span>
  <span class="kt">String</span> <span class="kd">get</span> <span class="n">transientValue</span> <span class="o">=&gt;</span> <span class="p">...;</span>
<span class="p">}</span>
</pre></div>


<p>On a related note, persistent properties are always included in <code>asMap()</code> by default, but can be omitted by adding <code>Column</code> metadata with the <code>omitByDefault</code> option:</p>
<div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">_User</span> <span class="p">{</span>
  <span class="err">@</span><span class="n">Column</span><span class="p">(</span><span class="nl">omitByDefault:</span> <span class="kc">true</span><span class="p">)</span>
  <span class="kt">String</span> <span class="n">salt</span><span class="p">;</span>

  <span class="err">@</span><span class="n">Column</span><span class="p">(</span><span class="nl">omitByDefault:</span> <span class="kc">true</span><span class="p">)</span>
  <span class="kt">String</span> <span class="n">hashedPassword</span><span class="p">;</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>


<h3 id="serialization-and-deserialization-of-relationship-properties">Serialization and Deserialization of Relationship Properties</h3>
<p>Relationship properties - references to other <code>ManagedObject&lt;T&gt;</code> subclasses - can also be included in <code>asMap()</code> and read from <code>readFromMap()</code>. Relationship properties are populated when using <code>Query.join</code> - aka, a SQL JOIN.</p>
<p>If a relationship property has been set or read from the database, its <code>asMap()</code> will contain the nested <code>Map</code> produced by the related objects <code>asMap()</code>. For example, recall the <code>User</code> with a <code>job</code>:</p>
<div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="n">job</span> <span class="o">=</span> <span class="n">Job</span><span class="p">()</span>
  <span class="p">..</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Programmer&quot;</span><span class="p">;</span>
<span class="kd">var</span> <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">()</span>
  <span class="p">..</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Bob&quot;</span>
  <span class="p">..</span><span class="n">job</span> <span class="o">=</span> <span class="n">job</span><span class="p">;</span>

<span class="kd">var</span> <span class="n">userMap</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">asMap</span><span class="p">();</span>
<span class="n">userMap</span> <span class="o">==</span> <span class="p">{</span>
  <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="m">1</span><span class="p">,</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span>
  <span class="s2">&quot;job&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="m">1</span>
    <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;Programmer&quot;</span>
  <span class="p">}</span>
<span class="p">};</span> <span class="c1">// yup</span>
</pre></div>


<p>Notice that the names of the keys - including relationship properties and properties of the related object - all match the names of their declared properties.</p>
<p>It's important to note that "belongs to" relationships - those with <code>Relate</code> metadata - are always returned in <code>asMap()</code> when fetching an object from the database. However, the full object is not returned - only its primary key. Therefore, you will get the following result:</p>
<div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="n">jobQuery</span> <span class="o">=</span> <span class="n">Query</span><span class="o">&lt;</span><span class="n">Job</span><span class="o">&gt;</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
<span class="kd">var</span> <span class="n">job</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">jobQuery</span><span class="p">.</span><span class="n">fetchOne</span><span class="p">();</span>

<span class="n">job</span><span class="p">.</span><span class="n">asMap</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span>
  <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="m">1</span><span class="p">,</span>
  <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;Programmer&quot;</span><span class="p">,</span>
  <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="m">1</span>
  <span class="p">}</span>
<span class="p">};</span> <span class="c1">// yup</span>
</pre></div>


<p>This behavior might be different than some ORMs, which may collapse the <code>user</code> into a scalar <code>user_id</code>:</p>
<div class="codehilite"><pre><span></span><span class="n">job</span><span class="p">.</span><span class="n">asMap</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span>
  <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="m">1</span><span class="p">,</span>
  <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;Programmer&quot;</span><span class="p">,</span>
  <span class="s2">&quot;user_id&quot;</span><span class="o">:</span> <span class="m">1</span>
<span class="p">};</span> <span class="c1">// nope</span>
</pre></div>


<p>Aqueduct treats relationships consistently and chooses not to expose any of the underlying database details to the API consumer. An iOS app, for example, shouldn't care - a relationship could be maintained by foreign key references or by witchcraft. The interesting piece to the API consumer is that job's have a user, and user's have a job.</p>
<p>"Has-many" relationships, which are represented as <code>ManagedSet&lt;T&gt;</code>s, are written as <code>List&lt;Map&gt;</code>s in <code>asMap()</code>.</p>
<div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">()</span>
  <span class="p">..</span><span class="n">id</span> <span class="o">=</span> <span class="m">1</span><span class="p">;</span>
  <span class="p">..</span><span class="n">posts</span> <span class="o">=</span> <span class="n">ManagedSet</span><span class="p">.</span><span class="n">from</span><span class="p">([</span>
      <span class="n">Post</span><span class="p">()..</span><span class="n">id</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span>
      <span class="n">Post</span><span class="p">()..</span><span class="n">id</span> <span class="o">=</span> <span class="m">3</span>
  <span class="p">]);</span>

<span class="kd">var</span> <span class="n">userMap</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">asMap</span><span class="p">();</span>
<span class="n">userMap</span> <span class="o">==</span> <span class="p">{</span>
  <span class="s1">&#39;id&#39;</span> <span class="o">:</span> <span class="m">1</span><span class="p">,</span>
  <span class="s1">&#39;posts&#39;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s1">&#39;id&#39;</span> <span class="o">:</span> <span class="m">2</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s1">&#39;id&#39;</span> <span class="o">:</span> <span class="m">3</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">};</span>
</pre></div>


<p>It is important to note the potential for cyclic object graphs. Since all relationship properties are two-sided, the two properties in that relationship are references to one another. That is, you could do something like this:</p>
<div class="codehilite"><pre><span></span><span class="n">identical</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">profile</span><span class="p">.</span><span class="n">user</span><span class="p">,</span> <span class="n">user</span><span class="p">);</span>
<span class="n">identical</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">posts</span><span class="p">.</span><span class="n">first</span><span class="p">.</span><span class="n">user</span><span class="p">,</span> <span class="n">user</span><span class="p">);</span>
</pre></div>


<p>When fetching objects from a database, this won't happen - Aqueduct will create multiple instances of the same row when necessary to avoid this. Therefore, the previous code snippet would not be true, but the following two statements that check the values inside those objects would be:</p>
<div class="codehilite"><pre><span></span>user.profile.user.id == user.id;

user.posts.first.user.id == user.id
</pre></div>


<p>While managed objects from a database will not have cyclic references, managed objects you instantiate yourself can if you mistakenly do so. When you invoke <code>asMap()</code> on a cyclic graph, you'll get a stack overflow error. It's best to avoid creating cyclic graphs altogether. For example:</p>
<div class="codehilite"><pre><span></span><span class="c1">// do:</span>
<span class="kd">var</span> <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">();</span>
<span class="n">posts</span><span class="p">.</span><span class="n">forEach</span><span class="p">((</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">p</span><span class="p">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">()..</span><span class="n">id</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// do not:</span>
<span class="kd">var</span> <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">();</span>
<span class="n">posts</span><span class="p">.</span><span class="n">forEach</span><span class="p">((</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">p</span><span class="p">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>


<p>When reading the values of a <code>ManagedObject&lt;T&gt;</code> with <code>readFromMap()</code>, relationship properties must also be represented as nested <code>Map</code>s or <code>List&lt;Map&gt;</code>. Thus:</p>
<div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="n">userMap</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="m">1</span><span class="p">,</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span>
  <span class="s2">&quot;posts&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="m">1</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="o">:</span> <span class="s2">&quot;hello&quot;</span><span class="p">}</span>
  <span class="p">]</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">()..</span><span class="n">readFromMap</span><span class="p">(</span><span class="n">userMap</span><span class="p">);</span>
<span class="n">user</span><span class="p">.</span><span class="n">posts</span> <span class="o">==</span> <span class="n">ManagedSet</span><span class="o">&lt;</span><span class="n">Post</span><span class="o">&gt;</span><span class="p">[</span>
  <span class="n">Post</span><span class="p">()</span>
    <span class="p">..</span><span class="n">id</span> <span class="o">=</span> <span class="m">1</span>
    <span class="p">..</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;hello&quot;</span>
<span class="p">];</span> <span class="c1">// yup, other Post doesn&#39;t implement == to check property equality</span>
</pre></div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../modeling_data/" title="Modeling Data" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Modeling Data
              </span>
            </div>
          </a>
        
        
          <a href="../executing_queries/" title="Executing Queries" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Executing Queries
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Built by stable|kernel
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-3700c4cc12.js"></script>
      
      
      <script>app.initialize({url:{base:"../.."}})</script>
      
    
    
      
      <script>!function(e,t,a,n,o,c,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),i=t.getElementsByTagName(a)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-41269877-2","aqueduct.io"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",t,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>