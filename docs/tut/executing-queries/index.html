
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for Aqueduct, a Dart server-side framework.">
      
      
      
      
        <link rel="shortcut icon" href="../../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.7.4">
    
    
      
        <title>3. Executing Database Queries - Aqueduct</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-1df76c4e58.js"></script>
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-769c285a91.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../style/css/override.css">
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="../.." title="Aqueduct" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Tutorial
                </span>
              
            
            3. Executing Database Queries
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/stablekernel/aqueduct" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    Aqueduct
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/stablekernel/aqueduct" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../getting_started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../tour/" title="Tour" class="md-nav__link">
      Tour
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../intellij/" title="IntelliJ IDEA Templates" class="md-nav__link">
      IntelliJ IDEA Templates
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Tutorial
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../getting-started/" title="1. Getting Started" class="md-nav__link">
      1. Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../writing-tests/" title="2. Writing Tests" class="md-nav__link">
      2. Writing Tests
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        3. Executing Database Queries
      </label>
    
    <a href="./" title="3. Executing Database Queries" class="md-nav__link md-nav__link--active">
      3. Executing Database Queries
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#object-relational-mapping" title="Object-Relational Mapping" class="md-nav__link">
    Object-Relational Mapping
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-a-data-model" title="Building a Data Model" class="md-nav__link">
    Building a Data Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-a-context" title="Defining a Context" class="md-nav__link">
    Defining a Context
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#executing-queries" title="Executing Queries" class="md-nav__link">
    Executing Queries
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-a-database" title="Setting Up a Database" class="md-nav__link">
    Setting Up a Database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-more-you-know-query-parameters-and-http-headers" title="The more you know: Query Parameters and HTTP Headers" class="md-nav__link">
    The more you know: Query Parameters and HTTP Headers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-relationships-and-joins" title="Next: Relationships and Joins" class="md-nav__link">
    Next: Relationships and Joins
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../model-relationships-and-joins/" title="4. Advanced Database Queries" class="md-nav__link">
      4. Advanced Database Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deploying-and-other-fun-things/" title="5. Deploying" class="md-nav__link">
      5. Deploying
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Serving HTTP Requests
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Serving HTTP Requests
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/structure/" title="Application Structure" class="md-nav__link">
      Application Structure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/request_and_response/" title="Request and Response Objects" class="md-nav__link">
      Request and Response Objects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/request_controller/" title="Handling Requests: Fundamentals" class="md-nav__link">
      Handling Requests: Fundamentals
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/routing/" title="Routing" class="md-nav__link">
      Routing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/request_sink/" title="Initialization and the RequestSink" class="md-nav__link">
      Initialization and the RequestSink
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/http_controller/" title="Handling Requests: HTTPController" class="md-nav__link">
      Handling Requests: HTTPController
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/configure/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/serving_files/" title="Serving Files and Caching" class="md-nav__link">
      Serving Files and Caching
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/websockets/" title="Websockets" class="md-nav__link">
      Websockets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../http/threading/" title="Multi-threading" class="md-nav__link">
      Multi-threading
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Databases and ORM
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Databases and ORM
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/connecting/" title="Connecting to a Database" class="md-nav__link">
      Connecting to a Database
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/modeling_data/" title="Modeling Data" class="md-nav__link">
      Modeling Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/serialization/" title="Storage, Serialization and Deserialization" class="md-nav__link">
      Storage, Serialization and Deserialization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/executing_queries/" title="Executing Queries" class="md-nav__link">
      Executing Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/advanced_queries/" title="Advanced Queries" class="md-nav__link">
      Advanced Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/validations/" title="Validations" class="md-nav__link">
      Validations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../db/db_tools/" title="Migration and Tooling" class="md-nav__link">
      Migration and Tooling
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Authorization and OAuth 2.0
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Authorization and OAuth 2.0
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../auth/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../auth/server/" title="Setting up Authorization" class="md-nav__link">
      Setting up Authorization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../auth/authorizer/" title="Protecting Routes" class="md-nav__link">
      Protecting Routes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../auth/controllers/" title="Issuing Access Tokens" class="md-nav__link">
      Issuing Access Tokens
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../auth/cli/" title="Managing OAuth 2.0 Clients" class="md-nav__link">
      Managing OAuth 2.0 Clients
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../auth/auth_scopes/" title="OAuth 2.0 Scoping" class="md-nav__link">
      OAuth 2.0 Scoping
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../auth/what_is_oauth/" title="What is OAuth 2.0?" class="md-nav__link">
      What is OAuth 2.0?
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Development and Testing
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Development and Testing
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../testing/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../testing/database/" title="Using a Local Database" class="md-nav__link">
      Using a Local Database
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../testing/debugger/" title="Using the Debugger" class="md-nav__link">
      Using the Debugger
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../testing/best_practices/" title="Development Best Practices" class="md-nav__link">
      Development Best Practices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../testing/clients/" title="Developing Client Applications" class="md-nav__link">
      Developing Client Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../testing/tests/" title="Writing Tests" class="md-nav__link">
      Writing Tests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../testing/mock/" title="Mocking Services" class="md-nav__link">
      Mocking Services
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Deployment
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Deployment
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/deploy_local/" title="Deploy Locally" class="md-nav__link">
      Deploy Locally
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/deploy_heroku/" title="Deploy on Heroku" class="md-nav__link">
      Deploy on Heroku
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/deploy_aws/" title="Deploy on AWS" class="md-nav__link">
      Deploy on AWS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/script/" title="Deploying without aqueduct serve" class="md-nav__link">
      Deploying without aqueduct serve
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Command-line Tooling
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Command-line Tooling
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/create/" title="Creating Applications" class="md-nav__link">
      Creating Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/running/" title="Running Applications" class="md-nav__link">
      Running Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/document/" title="Generating an OpenAPI/Swagger Specification" class="md-nav__link">
      Generating an OpenAPI/Swagger Specification
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/setup/" title="Other Tools" class="md-nav__link">
      Other Tools
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      Snippets
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        Snippets
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../snippets/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../snippets/http/" title="HTTP" class="md-nav__link">
      HTTP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../snippets/orm/" title="ORM" class="md-nav__link">
      ORM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../snippets/auth/" title="Authentication and Authorization" class="md-nav__link">
      Authentication and Authorization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../snippets/test/" title="Testing" class="md-nav__link">
      Testing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#object-relational-mapping" title="Object-Relational Mapping" class="md-nav__link">
    Object-Relational Mapping
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-a-data-model" title="Building a Data Model" class="md-nav__link">
    Building a Data Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-a-context" title="Defining a Context" class="md-nav__link">
    Defining a Context
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#executing-queries" title="Executing Queries" class="md-nav__link">
    Executing Queries
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-a-database" title="Setting Up a Database" class="md-nav__link">
    Setting Up a Database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-more-you-know-query-parameters-and-http-headers" title="The more you know: Query Parameters and HTTP Headers" class="md-nav__link">
    The more you know: Query Parameters and HTTP Headers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-relationships-and-joins" title="Next: Relationships and Joins" class="md-nav__link">
    Next: Relationships and Joins
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/stablekernel/aqueduct/edit/master/docs/tut/executing-queries.md" title="Edit this page" class="md-icon md-content__icon">edit</a>
                
                
                <h1 id="3-executing-queries">3. Executing Queries</h1>
<p>We will continue to build on the last chapter's project, <code>quiz</code>, by storing questions in a database and retrieving them from the database.</p>
<h2 id="object-relational-mapping">Object-Relational Mapping</h2>
<p>For a quick prelude, let's make sure we understand what an object-relational mapping (ORM) is. There are different kinds of databases that have different use cases. A relational database management system - which pretty much means a 'SQL' database - stores its data in the form of tables. A table represents some sort of entity - like a person or a bank account - and has columns that describe the attributes of that entity - like a name or a balance. Every row in a table is an instance of that entity - like a single person named Bob or Bob's bank account.</p>
<p>In an object-oriented framework like Aqueduct, we have a similar concept: a class represents some sort of entity, and an object with that class is an instance of that entity. An ORM maps rows in a database to and from objects in an application. In Aqueduct, each database table-class pairing is called an <em>entity</em>. Collectively, an application's entities are called its data model.</p>
<h2 id="building-a-data-model">Building a Data Model</h2>
<p>In our <code>quiz</code> application, we really have one type of entity - a "question". We will create an entity by declaring a class whose instances represent a question.</p>
<p>Create a new directory <code>lib/model/</code> and then add a new file to it named <code>lib/model/question.dart</code>. Add the following code:</p>
<div class="codehilite"><pre><span></span><span class="k">import</span> <span class="s1">&#39;../quiz.dart&#39;</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">Question</span> <span class="kd">extends</span> <span class="n">ManagedObject</span><span class="o">&lt;</span><span class="n">_Question</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">_Question</span> <span class="p">{}</span>

<span class="kd">class</span> <span class="nc">_Question</span> <span class="p">{</span>
  <span class="err">@</span><span class="n">managedPrimaryKey</span>
  <span class="kt">int</span> <span class="n">index</span><span class="p">;</span>

  <span class="kt">String</span> <span class="n">description</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>This declares a "question" entity. The class <code>_Question</code> is a one-to-one mapping to a database table with the same name. Each of its properties - <code>index</code> and <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/APIHeader/description.html">description</a> - are columns in that table. When the ORM fetches rows from the <code>_Question</code> table, they will be returned as instances of <code>Question</code>.</p>
<p><img alt="ManagedObject Diagram" src="../../img/tut3_db.png" /></p>
<p>When declaring an entity, there must be two classes:</p>
<ul>
<li>A <em>persistent type</em> that starts with a <code>_</code>, has exactly one primary key property, and declares a property for each database column. In the above, the persistent type is <code>_Question</code>.</li>
<li>An <em>instance type</em> that extends <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/ManagedObject-class.html">ManagedObject&lt;T&gt;</a> (where <code>T</code> is the persistent type). The instance type also implements the persistent type so that it has the same properties. In the above, the instance type is <code>Question</code>.</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Why two classes?</p>
<p>The two classes allow for much of the powerful behavior of the Aqueduct ORM. Answering this question requires a understanding of those behaviors, which we won't cover much in this beginner's tutorial. Once you've got the basics down, check out <a href="../../db/modeling_data/">this guide</a> for more detail.</p>
</div>
<p>During application initialization, the data model gets compiled so that it information about these entities is available at runtime to the components that need it. In <code>quiz_sink.dart</code>, add the following code to the constructor:</p>
<div class="codehilite"><pre><span></span><span class="n">QuizSink</span><span class="p">(</span><span class="n">ApplicationConfiguration</span> <span class="n">appConfig</span><span class="p">)</span> <span class="o">:</span> <span class="k">super</span><span class="p">(</span><span class="n">appConfig</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* This line was added by the template */</span>
  <span class="n">logger</span><span class="p">.</span><span class="n">onRecord</span><span class="p">.</span><span class="n">listen</span><span class="p">((</span><span class="n">rec</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$</span><span class="n">rec</span><span class="s2"> </span><span class="si">${</span><span class="n">rec</span><span class="p">.</span><span class="n">error</span> <span class="o">??</span> <span class="s2">&quot;&quot;</span><span class="si">}</span><span class="s2"> </span><span class="si">${</span><span class="n">rec</span><span class="p">.</span><span class="n">stackTrace</span> <span class="o">??</span> <span class="s2">&quot;&quot;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">));</span>

  <span class="kd">var</span> <span class="n">dataModel</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ManagedDataModel</span><span class="p">.</span><span class="n">fromCurrentMirrorSystem</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>


<p>The <code>fromCurrentMirrorSystem</code> constructor will be able to find all of the <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/ManagedObject-class.html">ManagedObject&lt;T&gt;</a> subclasses in your application. This data model will be one of the two necessary components for our next task, creating a <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/ManagedContext-class.html">ManagedContext</a>.</p>
<h2 id="defining-a-context">Defining a Context</h2>
<p>A <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/ManagedContext-class.html">ManagedContext</a> is an application's gateway to a database. It maintains a connection to a database, executes queries on that database, and translates the results to and from <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/ManagedObject-class.html">ManagedObject&lt;T&gt;</a>s according to a <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/ManagedDataModel-class.html">ManagedDataModel</a>. We have the data model already, so now we must provide database connection information. In <code>quiz_sink.dart</code>, declare a new property and add a few more lines to the constructor:</p>
<div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">QuizSink</span> <span class="kd">extends</span> <span class="n">RequestSink</span> <span class="p">{</span>
  <span class="n">QuizSink</span><span class="p">(</span><span class="n">ApplicationConfiguration</span> <span class="n">options</span><span class="p">)</span> <span class="o">:</span> <span class="k">super</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">logger</span><span class="p">.</span><span class="n">onRecord</span><span class="p">.</span><span class="n">listen</span><span class="p">((</span><span class="n">rec</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$</span><span class="n">rec</span><span class="s2"> </span><span class="si">${</span><span class="n">rec</span><span class="p">.</span><span class="n">error</span> <span class="o">??</span> <span class="s2">&quot;&quot;</span><span class="si">}</span><span class="s2"> </span><span class="si">${</span><span class="n">rec</span><span class="p">.</span><span class="n">stackTrace</span> <span class="o">??</span> <span class="s2">&quot;&quot;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">));</span>

    <span class="kd">var</span> <span class="n">dataModel</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ManagedDataModel</span><span class="p">.</span><span class="n">fromCurrentMirrorSystem</span><span class="p">();</span>

    <span class="kd">var</span> <span class="n">persistentStore</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PostgreSQLPersistentStore</span><span class="p">.</span><span class="n">fromConnectionInfo</span><span class="p">(</span>
      <span class="s2">&quot;dart&quot;</span><span class="p">,</span> <span class="s2">&quot;dart&quot;</span><span class="p">,</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="m">5432</span><span class="p">,</span> <span class="s2">&quot;dart_test&quot;</span><span class="p">);</span>

    <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ManagedContext</span><span class="p">(</span><span class="n">dataModel</span><span class="p">,</span> <span class="n">persistentStore</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">ManagedContext</span> <span class="n">context</span><span class="p">;</span>

  <span class="p">...</span>
</pre></div>


<p>This creates a context that connects to the database <code>postgres://dart:dart@localhost:5432/dart_test</code> that has a single <code>_Question</code> table. Before we create that database, let's finish writing the code that will fetch questions from a database.</p>
<h2 id="executing-queries">Executing Queries</h2>
<p>Once a context has been created, when can execute <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Query-class.html">Query&lt;T&gt;</a>s on it. In <code>lib/controller/question_controller.dart</code>, replace the implementation of <code>getAllQuestions</code> to fetch questions from a database and import the file that declares <code>Question</code>:</p>
<div class="codehilite"><pre><span></span><span class="k">import</span> <span class="s1">&#39;../quiz.dart&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="s1">&#39;../model/question.dart&#39;</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">QuestionController</span> <span class="kd">extends</span> <span class="n">HttpController</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="n">questions</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;How much wood can a woodchuck chuck?&quot;</span><span class="p">,</span>
    <span class="s2">&quot;What&#39;s the tallest mountain in the world?&quot;</span>
  <span class="p">];</span>

  <span class="err">@</span><span class="n">httpGet</span>
  <span class="n">Future</span><span class="o">&lt;</span><span class="n">Response</span><span class="o">&gt;</span> <span class="n">getAllQuestions</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="n">questionQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Query</span><span class="o">&lt;</span><span class="n">Question</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="kd">var</span> <span class="n">databaseQuestions</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">questionQuery</span><span class="p">.</span><span class="n">fetch</span><span class="p">();</span>

    <span class="k">return</span> <span class="k">new</span> <span class="n">Response</span><span class="p">.</span><span class="n">ok</span><span class="p">(</span><span class="n">databaseQuestions</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">...</span>
</pre></div>


<p>In <code>getAllQuestions</code>, we create an instance of <code>Query&lt;Question&gt;</code> and then execute its <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Query/fetch.html">fetch()</a> method. This method will fetch every question from the database and returns them as a <code>List&lt;Question&gt;</code> into the variable <code>databaseQuestions</code>. This list is the body object to the <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Response-class.html">Response</a>, which by default, encodes them as a list of JSON objects.</p>
<div class="admonition note">
<p class="admonition-title">Where's the context?</p>
<p>Most applications only talk to a single database and therefore have a single <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/ManagedContext-class.html">ManagedContext</a>. When creating a <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Query-class.html">Query&lt;T&gt;</a> without specifying a context, the query defaults to executing on the last context created - which happens to be the one we instantiated in <code>QuizSink</code>.</p>
</div>
<p>Now, let's update <code>getQuestionAtIndex</code> to fetch a single question by its index from the database.</p>
<div class="codehilite"><pre><span></span><span class="err">@</span><span class="n">httpGet</span>
<span class="n">Future</span><span class="o">&lt;</span><span class="n">Response</span><span class="o">&gt;</span> <span class="n">getQuestionAtIndex</span><span class="p">(</span><span class="err">@</span><span class="n">HTTPPath</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)</span> <span class="kt">int</span> <span class="n">index</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="n">questionQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Query</span><span class="o">&lt;</span><span class="n">Question</span><span class="o">&gt;</span><span class="p">()</span>
    <span class="p">..</span><span class="n">where</span><span class="p">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">whereEqualTo</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>    

  <span class="kd">var</span> <span class="n">question</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">questionQuery</span><span class="p">.</span><span class="n">fetchOne</span><span class="p">();</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">question</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Response</span><span class="p">.</span><span class="n">notFound</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">Response</span><span class="p">.</span><span class="n">ok</span><span class="p">(</span><span class="n">question</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>This query does two interesting things: it filters the result of the query by the question's index and only fetches a single question with <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/Query/fetchOne.html">fetchOne()</a>.</p>
<p>Filtering is accomplished through the <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/ApplicationMessageHub/where.html">where</a> property of a <code>Query&lt;Question&gt;</code>; this property has all of the same properties as <code>Question</code>. <em>Matchers</em> like <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/whereEqualTo.html">whereEqualTo</a> are set as the values of <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/ApplicationMessageHub/where.html">where</a>'s properties. This adds conditions to the where clause of the generated SQL query. In the above code, we constrain the query to only fetch questions whose <code>index</code> is equal to the <code>index</code> from the path variable. Since <code>index</code> is the primary key of <code>Question</code>, this will either give us a single question or return null.</p>
<div class="admonition tip">
<p class="admonition-title">Matching All the Things</p>
<p>There are a lot of matchers available to build different queries. All matchers start with the word <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/ApplicationMessageHub/where.html">where</a> and can be found by searching the <a href="https://www.dartdocs.org/documentation/aqueduct/latest/">API reference</a>.</p>
</div>
<h2 id="setting-up-a-database">Setting Up a Database</h2>
<p>Ensure that your PostgreSQL installation is running and open the command-line tool <code>psql</code>. In this tool, create a new database and a user that can connect to it with the following SQL:</p>
<div class="codehilite"><pre><span></span><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">dart_test</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">USER</span> <span class="n">dart</span> <span class="k">WITH</span> <span class="k">createdb</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">USER</span> <span class="n">dart</span> <span class="k">WITH</span> <span class="n">password</span> <span class="s1">&#39;dart&#39;</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">all</span> <span class="k">ON</span> <span class="k">database</span> <span class="n">dart_test</span> <span class="k">TO</span> <span class="n">dart</span><span class="p">;</span>
</pre></div>


<p>The user, password and database name match those provided when creating our <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/ManagedContext-class.html">ManagedContext</a> in <code>QuizSink</code>. This database will be used during testing. Before the tests run, the test harness will create tables for all of your entities in this database. After the tests complete, the tables will be deleted from this database. Therefore, this database should only be used for running tests.</p>
<p>We must update our test harness to create these tables. In <code>test/harness/app.dart</code>, add the following method to <code>TestApplication</code>:</p>
<div class="codehilite"><pre><span></span><span class="kd">static</span> <span class="n">Future</span> <span class="n">createDatabaseSchema</span><span class="p">(</span><span class="n">ManagedContext</span> <span class="n">context</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SchemaBuilder</span><span class="p">.</span><span class="n">toSchema</span><span class="p">(</span>
      <span class="n">context</span><span class="p">.</span><span class="n">persistentStore</span><span class="p">,</span> <span class="k">new</span> <span class="n">Schema</span><span class="p">.</span><span class="n">fromDataModel</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="n">dataModel</span><span class="p">),</span>
      <span class="nl">isTemporary:</span> <span class="kc">true</span><span class="p">);</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="n">cmd</span> <span class="k">in</span> <span class="n">builder</span><span class="p">.</span><span class="n">commands</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">await</span> <span class="n">context</span><span class="p">.</span><span class="n">persistentStore</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Then, in <code>TestApplication.start</code>, add the line that calls this method after <code>await application.start()</code>:</p>
<div class="codehilite"><pre><span></span><span class="n">Future</span> <span class="n">start</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
  <span class="n">RequestController</span><span class="p">.</span><span class="n">letUncaughtExceptionsEscape</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="n">application</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Application</span><span class="o">&lt;</span><span class="n">QuizSink</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="n">application</span><span class="p">.</span><span class="n">configuration</span><span class="p">.</span><span class="n">port</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
  <span class="n">application</span><span class="p">.</span><span class="n">configuration</span><span class="p">.</span><span class="n">configurationFilePath</span> <span class="o">=</span> <span class="s2">&quot;config.src.yaml&quot;</span><span class="p">;</span>

  <span class="kd">await</span> <span class="n">application</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="nl">runOnMainIsolate:</span> <span class="kc">true</span><span class="p">);</span>

  <span class="cm">/* Add this line */</span>
  <span class="kd">await</span> <span class="n">createDatabaseSchema</span><span class="p">(</span><span class="n">sink</span><span class="p">.</span><span class="n">context</span><span class="p">);</span>

  <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TestClient</span><span class="p">(</span><span class="n">application</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>Now when our tests in <code>question_controller_test.dart</code> go through their setup process, the SQL command to create the question table will be executed. The last thing left to do is populate this test database with questions during the test setup process. At the top of <code>question_controller_test.dart</code>, import <code>question.dart</code>:</p>
<div class="codehilite"><pre><span></span><span class="k">import</span> <span class="s1">&#39;package:quiz/model/question.dart&#39;</span><span class="p">;</span>
</pre></div>


<p>And then update the <code>setUpAll</code> method:</p>
<div class="codehilite"><pre><span></span><span class="n">setUpAll</span><span class="p">(()</span> <span class="kd">async</span> <span class="p">{</span>
  <span class="kd">await</span> <span class="n">app</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>

  <span class="kd">var</span> <span class="n">questions</span> <span class="o">=</span> <span class="p">[</span>
    <span class="k">new</span> <span class="n">Question</span><span class="p">()</span>
      <span class="p">..</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;How much wood can a woodchuck chuck?&quot;</span><span class="p">,</span>
    <span class="k">new</span> <span class="n">Question</span><span class="p">()</span>
      <span class="p">..</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;What&#39;s the tallest mountain in the world?&quot;</span><span class="p">,</span>
  <span class="p">];</span>

  <span class="kd">await</span> <span class="n">Future</span><span class="p">.</span><span class="n">forEach</span><span class="p">(</span><span class="n">questions</span><span class="p">,</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Query</span><span class="o">&lt;</span><span class="n">Question</span><span class="o">&gt;</span><span class="p">()</span>
        <span class="p">..</span><span class="n">values</span> <span class="o">=</span> <span class="n">q</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">query</span><span class="p">.</span><span class="n">insert</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>


<p>This inserts the two original questions as instances of <code>Question</code> into the database during setup. If we were to run our tests now, they would fail and the output would look like this:</p>
<div class="codehilite"><pre><span></span><span class="nt">Expected</span><span class="o">:</span> <span class="nt">---</span> <span class="nt">HTTP</span> <span class="nt">Response</span> <span class="nt">---</span>
          <span class="nt">-</span> <span class="nt">Status</span> <span class="nt">code</span> <span class="nt">must</span> <span class="nt">be</span> <span class="nt">200</span>
          <span class="nt">-</span> <span class="nt">Headers</span> <span class="nt">can</span> <span class="nt">be</span> <span class="nt">anything</span>
          <span class="nt">-</span> <span class="nt">Body</span> <span class="nt">after</span> <span class="nt">decoding</span> <span class="nt">must</span> <span class="nt">be</span><span class="o">:</span>

            <span class="o">(</span><span class="nt">an</span> <span class="nt">object</span> <span class="nt">with</span> <span class="nt">length</span> <span class="nt">of</span> <span class="nt">a</span> <span class="nt">value</span> <span class="nt">greater</span> <span class="nt">than</span> <span class="o">&lt;</span><span class="nt">0</span><span class="o">&gt;</span> <span class="nt">and</span> <span class="nt">every</span> <span class="nt">element</span><span class="o">(</span><span class="nt">a</span> <span class="nt">string</span> <span class="nt">ending</span> <span class="nt">with</span> <span class="s1">&#39;?&#39;</span><span class="o">))</span>
          <span class="nt">---------------------</span>
<span class="nt">Actual</span><span class="o">:</span> <span class="nt">TestResponse</span><span class="o">:&lt;</span><span class="nt">-----------</span>
        <span class="nt">-</span> <span class="nt">Status</span> <span class="nt">code</span> <span class="nt">is</span> <span class="nt">200</span>
        <span class="nt">-</span> <span class="nt">Headers</span> <span class="nt">are</span> <span class="nt">the</span> <span class="nt">following</span><span class="o">:</span>
          <span class="nt">-</span> <span class="nt">content-encoding</span><span class="o">:</span> <span class="nt">gzip</span>
          <span class="nt">-</span> <span class="nt">content-length</span><span class="o">:</span> <span class="nt">124</span>
          <span class="nt">-</span> <span class="nt">x-frame-options</span><span class="o">:</span> <span class="nt">SAMEORIGIN</span>
          <span class="nt">-</span> <span class="nt">content-type</span><span class="o">:</span> <span class="nt">application</span><span class="o">/</span><span class="nt">json</span><span class="o">;</span> <span class="nt">charset</span><span class="o">=</span><span class="nt">utf-8</span>
          <span class="nt">-</span> <span class="nt">x-xss-protection</span><span class="o">:</span> <span class="nt">1</span><span class="o">;</span> <span class="nt">mode</span><span class="o">=</span><span class="nt">block</span>
          <span class="nt">-</span> <span class="nt">x-content-type-options</span><span class="o">:</span> <span class="nt">nosniff</span>
          <span class="nt">-</span> <span class="nt">server</span><span class="o">:</span> <span class="nt">aqueduct</span><span class="o">/</span><span class="nt">1</span>
        <span class="nt">-------------------------</span>
        <span class="o">&gt;</span>
 <span class="nt">Which</span><span class="o">:</span> <span class="nt">the</span> <span class="nt">body</span> <span class="nt">differs</span> <span class="nt">for</span> <span class="nt">the</span> <span class="nt">following</span> <span class="nt">reasons</span><span class="o">:</span>
        <span class="nt">has</span> <span class="nt">value</span>
        <span class="p">{</span><span class="err">&#39;index&#39;:</span> <span class="err">1,</span> <span class="err">&#39;description&#39;:</span> <span class="err">&#39;How</span> <span class="err">much</span> <span class="err">wood</span> <span class="err">can</span> <span class="err">a</span> <span class="err">woodchuck</span> <span class="err">chuck?&#39;</span><span class="p">}</span>
          <span class="nt">which</span>
        <span class="p">{</span><span class="err">&#39;index&#39;:</span> <span class="err">1,</span> <span class="err">&#39;description&#39;:</span> <span class="err">&#39;How</span> <span class="err">much</span> <span class="err">wood</span> <span class="err">can</span> <span class="err">a</span> <span class="err">woodchuck</span> <span class="err">chuck?&#39;</span><span class="p">}</span>
          <span class="nt">not</span> <span class="nt">a</span> <span class="nt">string</span> <span class="nt">at</span> <span class="nt">index</span> <span class="nt">0</span>
</pre></div>


<p>Our tests currently verify that the response body contains a list of JSON strings that all end in <code>?</code>. However, now that we are returning a list of JSON objects that represent a question, each question has the following form:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;index&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;How much wood can a woodchuck chuck?&quot;</span>
<span class="p">}</span>
</pre></div>


<p>We'll need to update our tests so that we're verifying that the <em>description</em> of a question object ends with <code>?</code>. Wrap the <code>endsWith("?")</code> matchers in the two tests that use them with <code>containsPair</code>.</p>
<div class="codehilite"><pre><span></span><span class="n">test</span><span class="p">(</span><span class="s2">&quot;/questions returns list of questions&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
  <span class="n">expectResponse</span><span class="p">(</span>
    <span class="kd">await</span> <span class="n">app</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;/questions&quot;</span><span class="p">).</span><span class="kd">get</span><span class="p">(),</span>
    <span class="m">200</span><span class="p">,</span>
    <span class="nl">body:</span> <span class="n">allOf</span><span class="p">([</span>
      <span class="n">hasLength</span><span class="p">(</span><span class="n">greaterThan</span><span class="p">(</span><span class="m">0</span><span class="p">)),</span>
      <span class="n">everyElement</span><span class="p">(</span><span class="n">containsPair</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="n">endsWith</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">)))</span>
    <span class="p">]));</span>
<span class="p">});</span>

<span class="n">test</span><span class="p">(</span><span class="s2">&quot;/questions/index returns a single question&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
  <span class="n">expectResponse</span><span class="p">(</span>
    <span class="kd">await</span> <span class="n">app</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;/questions/1&quot;</span><span class="p">).</span><span class="kd">get</span><span class="p">(),</span>
    <span class="m">200</span><span class="p">,</span>
    <span class="nl">body:</span> <span class="n">containsPair</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="n">endsWith</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">)));</span>
<span class="p">});</span>
</pre></div>


<p>Run the tests again by right-clicking on the <code>main</code> function and selecting <code>Run</code>. They should all pass.</p>
<h2 id="the-more-you-know-query-parameters-and-http-headers">The more you know: Query Parameters and HTTP Headers</h2>
<p>So far, we have bound HTTP method and path parameters to responder methods in <code>QuestionController</code>. You can also bind query parameters, headers and request bodies, too.</p>
<p>We'll allow the <code>getAllQuestions</code> method to take a query parameter named <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/ApplicationMessageHub/contains.html">contains</a>. If this query parameter is part of the request, we'll filter the questions on whether or not that question contains some substring. In <code>question_controller.dart</code>, update this method by adding an optional parameter named <code>containsSubstring</code>:</p>
<div class="codehilite"><pre><span></span><span class="err">@</span><span class="n">httpGet</span>
<span class="n">Future</span><span class="o">&lt;</span><span class="n">Response</span><span class="o">&gt;</span> <span class="n">getAllQuestions</span><span class="p">({</span><span class="err">@</span><span class="n">HTTPQuery</span><span class="p">(</span><span class="s2">&quot;contains&quot;</span><span class="p">)</span> <span class="kt">String</span> <span class="n">containsSubstring</span><span class="p">})</span> <span class="kd">async</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="n">questionQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Query</span><span class="o">&lt;</span><span class="n">Question</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">containsSubstring</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">questionQuery</span><span class="p">.</span><span class="n">where</span><span class="p">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">whereContainsString</span><span class="p">(</span><span class="n">containsSubstring</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">var</span> <span class="n">databaseQuestions</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">questionQuery</span><span class="p">.</span><span class="n">fetch</span><span class="p">();</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">Response</span><span class="p">.</span><span class="n">ok</span><span class="p">(</span><span class="n">databaseQuestions</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>If an HTTP request has a <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/ApplicationMessageHub/contains.html">contains</a> query parameter, that value will be available in the <code>containsSubstring</code> variable when this method is invoked. Also, note that we first check <code>containsSubstring</code> to make sure it is not-null. If we simply assigned <code>null</code> to <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/APIHeader/description.html">description</a>, we'd be creating a matcher that checked to see if the <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/APIHeader/description.html">description</a> <em>contained</em> <code>null</code>.</p>
<div class="admonition tip">
<p class="admonition-title">HTTPController Binding</p>
<p>For more information on binding, see <a href="../../http/http_controller/">this guide</a>.</p>
</div>
<p>Then, add a new test in <code>question_controller_test.dart</code>:</p>
<div class="codehilite"><pre><span></span><span class="n">test</span><span class="p">(</span><span class="s2">&quot;/questions returns list of questions filtered by contains&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="n">request</span> <span class="o">=</span> <span class="n">app</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;/questions?contains=mountain&quot;</span><span class="p">);</span>
  <span class="n">expectResponse</span><span class="p">(</span>
    <span class="kd">await</span> <span class="n">request</span><span class="p">.</span><span class="kd">get</span><span class="p">(),</span>
    <span class="m">200</span><span class="p">,</span>
    <span class="nl">body:</span> <span class="p">[{</span>
      <span class="s2">&quot;index&quot;</span> <span class="o">:</span> <span class="n">greaterThanOrEqualTo</span><span class="p">(</span><span class="m">0</span><span class="p">),</span>
      <span class="s2">&quot;description&quot;</span> <span class="o">:</span> <span class="s2">&quot;What&#39;s the tallest mountain in the world?&quot;</span>
    <span class="p">}]);</span>  
<span class="p">});</span>
</pre></div>


<p>This test expects that the body is a list of exactly one object whose description is the one question we know has the word 'mountain' in it.</p>
<p>This test will pass, along with the rest of them. It's important to note that GET <code>/questions</code> without a <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/ApplicationMessageHub/contains.html">contains</a> query still yields the correct results. That is because the <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/HTTPQuery-class.html">HTTPQuery</a> argument was declared in the optional parameters portion of the responder method. If the parameter were in the required, positional set of parameters and the query string was not included, this request would respond with a 400. (The same positional vs. optional behavior is true of <a href="https://www.dartdocs.org/documentation/aqueduct/latest/aqueduct/HTTPHeader-class.html">HTTPHeader</a>s as well.)</p>
<p>Binding query and header parameters in a responder method is a good way to make your code more intentional and avoid boilerplate parsing code. Additionally, Aqueduct is able to generate documentation from method signatures - by using bindings, the documentation generator can add that information to the documentation.</p>
<h2 id="next-relationships-and-joins"><a href="../model-relationships-and-joins/">Next: Relationships and Joins</a></h2>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../writing-tests/" title="2. Writing Tests" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                2. Writing Tests
              </span>
            </div>
          </a>
        
        
          <a href="../model-relationships-and-joins/" title="4. Advanced Database Queries" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                4. Advanced Database Queries
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Built by stable|kernel
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-c35428f87f.js"></script>
      
      
      <script>app.initialize({url:{base:"../.."}})</script>
      
    
    
      
      <script>!function(e,t,a,n,o,c,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),i=t.getElementsByTagName(a)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-41269877-2","aqueduct.io"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",t,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>